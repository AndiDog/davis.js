<html>
	<head>
		<title>foo</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		<style>body {
    margin: 0;
    padding: 0;
    font: 14px/1.5 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
    color: #252519;
}
a {
    color: #252519;
}
a:hover {
    text-decoration: underline;
    color: #19469D;
}
p {
    margin: 12px 0;
}
h1, h2, h3 {
    margin: 0;
    padding: 0;
}
table#source {
    width: 100%;
    border-collapse: collapse;
}
table#source td:first-child {
    padding: 30px 40px 30px 40px;
    vertical-align: top;
}
table#source td:first-child,
table#source td:first-child pre {
    width: 450px;
}
table#source td:last-child {
    padding: 30px 0 30px 40px;
    border-left: 1px solid #E5E5EE;
    background: #F5F5FF;
}
table#source tr {
    border-bottom: 1px solid #E5E5EE;
}
table#source tr.filename {
    padding-top: 40px;
    border-top: 1px solid #E5E5EE;
}
table#source tr.filename td:first-child {
    text-transform: capitalize;
}
table#source tr.filename td:last-child {
    font-size: 12px;
}
table#source tr.filename h2 {
    margin: 0;
    padding: 0;
    cursor: pointer;
}
table#source tr.code h1,
table#source tr.code h2,
table#source tr.code h3 {
    margin-top: 30px;
    font-family: "Lucida Grande", "Helvetica Nueue", Arial, sans-serif;
    font-size: 18px;
}
table#source tr.code h2 {
    font-size: 16px;
}
table#source tr.code h3 {
    font-size: 14px;
}
table#source tr.code ul {
    margin: 15px 0 15px 35px;
    padding: 0;
}
table#source tr.code ul li {
    margin: 0;
    padding: 1px 0;
}
table#source tr.code ul li p {
    margin: 0;
    padding: 0;
}
table#source tr.code td:first-child pre {
    padding: 20px;
}
#ribbon {
    position: fixed;
    top: 0;
    right: 0;
}
code .string { color: #219161; }
code .regexp { color: #219161; }
code .keyword { color: #954121; }
code .number { color: #19469D; }
code .comment { color: #bbb; }
code .this { color: #19469D; }</style>
		<script>
			$(function(){
				$('tr.code').hide();
				$('tr.filename').toggle(function(){
					$(this).nextUntil('.filename').fadeIn();
				}, function(){
					$(this).nextUntil('.filename').fadeOut();
				});
			});
		</script>
	</head>
	<body>
<table id="source"><tbody><tr><td><h1>foo</h1></td><td></td></tr><tr class="filename"><td><h2 id="src/davis.app.js"><a href="#">davis.app</a></h2></td><td>src/davis.app.js</td></tr><tr class="code">
<td class="docs">
<p>A private scope for the Davis.App constructor
 </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="class">App</span> = (<span class="keyword">function</span> () {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Constructor for Davis.App
 - <strong>constructo</strong>: <em>r</em></p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>Davis.App</em> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">App</span> = <span class="keyword">function</span> () {
    <span class="this">this</span>.<span class="variable">id</span> = [<span class="keyword">new</span> <span class="class">Date</span>().<span class="variable">valueOf</span>(), <span class="variable">appCounter</span>++].<span class="variable">join</span>(&<span class="variable">quot</span>;-&<span class="variable">quot</span>;);
    <span class="this">this</span>.<span class="variable">running</span> = <span class="variable">false</span>;
  };</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>A convinience function for changing the apps default settings.
Should be used before starting the app to ensure any new settings
are picked up and used.</p>

<h2></h2>

<ul><li><strong>param</strong>: <em>Function</em>  config This function will be executed with the context bound to the apps setting object</li></ul>

<h2>Example</h2>

<pre><code>app.configure(function () {
  this.linkSelector: 'a.davis'
  this.formSelector: 'form.davis'
})
 </code></pre>
</td>
<td class="code">
<pre><code><span class="variable">configure</span>: <span class="keyword">function</span> (<span class="variable">config</span>) {
      <span class="variable">config</span>.<span class="variable">call</span>(<span class="this">this</span>.<span class="variable">settings</span>);
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Settings for the app.  These may be overriden directly or by using the configure
convinience method.</p>

<p><code>linkSelector</code> is the jquery selector for all the links on the page that you want
Davis to respond to.  These links will not trigger a normal http request.</p>

<p><code>formSelector</code> is similar to link selector but for all the forms that davis will bind to</p>

<p><code>logger</code> is the object that the app will use to log through.</p>

<ul><li><strong>se</strong>: <em>e</em>
#configure
 </li></ul>
</td>
<td class="code">
<pre><code><span class="variable">settings</span>: {
      <span class="variable">linkSelector</span>: <span class="string">'a'</span>,
      <span class="variable">formSelector</span>: <span class="string">'form'</span>,
      <span class="variable">logger</span>: <span class="class">Davis</span>.<span class="variable">logger</span>
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Starting the app does a number of things, it binds to all links and forms that are selected
according to the settings.  It also starts listening to history pop and push events.
The start method should be called after declaring all routes and after setting any configuration
that you want.
     </p>
</td>
<td class="code">
<pre><code><span class="variable">start</span>: <span class="keyword">function</span> () {
      <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;

      <span class="this">this</span>
        .<span class="variable">bind</span>(<span class="string">'runRoute'</span>, <span class="keyword">function</span> (<span class="variable">request</span>) {
          <span class="variable">self</span>.<span class="variable">settings</span>.<span class="variable">logger</span>.<span class="variable">info</span>(&<span class="variable">quot</span>;<span class="variable">runRoute</span>: &<span class="variable">quot</span>; + <span class="variable">request</span>.<span class="variable">toString</span>());
        })
        .<span class="variable">bind</span>(<span class="string">'routeNotFound'</span>, <span class="keyword">function</span> (<span class="variable">request</span>) {
          <span class="variable">self</span>.<span class="variable">settings</span>.<span class="variable">logger</span>.<span class="variable">warn</span>(&<span class="variable">quot</span>;<span class="variable">routeNotFound</span>: &<span class="variable">quot</span>; + <span class="variable">request</span>.<span class="variable">toString</span>());
        })
        .<span class="variable">bind</span>(<span class="string">'start'</span>, <span class="keyword">function</span> () {
          <span class="variable">self</span>.<span class="variable">settings</span>.<span class="variable">logger</span>.<span class="variable">info</span>(&<span class="variable">quot</span>;<span class="variable">application</span> <span class="variable">started</span>&<span class="variable">quot</span>;)
        });

      <span class="this">this</span>.<span class="variable">listen</span>();
      <span class="this">this</span>.<span class="variable">trigger</span>(<span class="string">'start'</span>)

      <span class="keyword">var</span> <span class="variable">runFilterWith</span> = <span class="keyword">function</span> (<span class="variable">request</span>) {
        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="variable">filter</span>) {
          <span class="keyword">var</span> <span class="variable">result</span> = <span class="variable">filter</span>.<span class="variable">run</span>(<span class="variable">request</span>, <span class="variable">request</span>);
          <span class="keyword">return</span> (<span class="keyword">typeof</span> <span class="variable">result</span> === &<span class="variable">quot</span>;<span class="variable">undefined</span>&<span class="variable">quot</span>; || <span class="variable">result</span>);
        }
      }

      <span class="keyword">var</span> <span class="variable">beforeFiltersPass</span> = <span class="keyword">function</span> (<span class="variable">request</span>) {
        <span class="keyword">return</span> <span class="variable">self</span>.<span class="variable">lookupBeforeFilter</span>(<span class="variable">request</span>.<span class="variable">method</span>, <span class="variable">request</span>.<span class="variable">path</span>)
                      .<span class="variable">every</span>(<span class="variable">runFilterWith</span>(<span class="variable">request</span>))
      }

      <span class="class">Davis</span>.<span class="variable">history</span>.<span class="variable">onChange</span>(<span class="keyword">function</span> (<span class="variable">request</span>) {
        <span class="keyword">if</span> (<span class="variable">beforeFiltersPass</span>(<span class="variable">request</span>)) {
          <span class="variable">self</span>.<span class="variable">trigger</span>(<span class="string">'lookupRoute'</span>, <span class="variable">request</span>)
          <span class="keyword">var</span> <span class="variable">route</span> = <span class="variable">self</span>.<span class="variable">lookupRoute</span>(<span class="variable">request</span>.<span class="variable">method</span>, <span class="variable">request</span>.<span class="variable">path</span>);
          <span class="keyword">if</span> (<span class="variable">route</span>) {
            <span class="variable">self</span>.<span class="variable">trigger</span>(<span class="string">'runRoute'</span>, <span class="variable">request</span>);
            <span class="variable">route</span>.<span class="variable">run</span>(<span class="variable">request</span>);
            <span class="variable">self</span>.<span class="variable">lookupAfterFilter</span>(<span class="variable">request</span>.<span class="variable">method</span>, <span class="variable">request</span>.<span class="variable">path</span>)
                  .<span class="variable">every</span>(<span class="variable">runFilterWith</span>(<span class="variable">request</span>));
          } <span class="keyword">else</span> {
            <span class="variable">self</span>.<span class="variable">trigger</span>(<span class="string">'routeNotFound'</span>, <span class="variable">request</span>);
          }
        } <span class="keyword">else</span> {
          <span class="variable">self</span>.<span class="variable">trigger</span>(<span class="string">'requestHalted'</span>, <span class="variable">request</span>)
        }
      });

      <span class="this">this</span>.<span class="variable">running</span> = <span class="variable">true</span>;
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Stops the app listening to clicks and submits on all forms and links found using the current
apps settings.
     </p>
</td>
<td class="code">
<pre><code><span class="variable">stop</span>: <span class="keyword">function</span> () {
      <span class="this">this</span>.<span class="variable">unlisten</span>();
      <span class="this">this</span>.<span class="variable">trigger</span>(<span class="string">'stop'</span>)
    }</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.event.js"><a href="#">davis.event</a></h2></td><td>src/davis.event.js</td></tr><tr class="code">
<td class="docs">
<p>A module that can be mixed into any object to provide basic event functionality.
This module is mixed into the prototype of Davis.App.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="variable">event</span> = {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Binds a callback to a named event.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  eventName</p></li><li><p><strong>param</strong>: <em>Function</em>  callback</p></li></ul>

<p>The callback will be called with its context set to which ever object this module
has been mixed into.  Any data that is passed when triggering the event will be passed
to the callback function as the first parameter.</p>

<p>The following events are triggered internally by Davis and can be bound to:</p>

<p> <strong>start</strong> : Triggered when the application is started</p>

<p> <strong>lookupRoute</strong> : Triggered before looking up a route, the request being looked up is passed as an argument</p>

<p> <strong>runRoute</strong> : Triggered before running a route, the request and route being run are passed as arguments</p>

<p> <strong>routeNotFound</strong> : Triggered if no route for the current request can be found, the current request is passed as an arugment</p>

<p> <strong>requestHalted</strong> : Triggered when a before filter halts the current request, the current request is passed as an argument</p>

<h2>Example</h2>

<pre><code>app.bind('runRoute', function () {
  console.log('just about to run a route!')
})</code></pre>

<p>   </p>
</td>
<td class="code">
<pre><code><span class="variable">bind</span>: <span class="keyword">function</span> (<span class="variable">eventName</span>, <span class="variable">callback</span>) {
    <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">_callbacks</span>[<span class="variable">eventName</span>]) <span class="this">this</span>.<span class="variable">_callbacks</span>[<span class="variable">eventName</span>] = [];
    <span class="this">this</span>.<span class="variable">_callbacks</span>[<span class="variable">eventName</span>].<span class="variable">push</span>(<span class="variable">callback</span>);
    <span class="keyword">return</span> <span class="this">this</span>;
  },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Triggers an event on the current object.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  eventName</p></li><li><p><strong>param</strong>: <em>Object</em>  data (optional)</p></li></ul>

<p>Triggers an event on the current object, all callbacks bound using bind will be called.
An optional second param can be passed which will be passed as an argument to each callback
bound to the named event.</p>

<h2>Example</h2>

<pre><code>app.triger('foo')
app.trigger('bar', {baz: true})</code></pre>

<p>   </p>
</td>
<td class="code">
<pre><code><span class="variable">trigger</span>: <span class="keyword">function</span> (<span class="variable">eventName</span>, <span class="variable">data</span>) {
    <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
    <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">_callbacks</span>[<span class="variable">eventName</span>]) <span class="this">this</span>.<span class="variable">_callbacks</span>[<span class="variable">eventName</span>] = [];
    <span class="this">this</span>.<span class="variable">_callbacks</span>[<span class="variable">eventName</span>].<span class="variable">forEach</span>(<span class="keyword">function</span> (<span class="variable">callback</span>) {
      <span class="variable">callback</span>.<span class="variable">call</span>(<span class="variable">self</span>, <span class="variable">data</span>);
    }) 
    <span class="keyword">return</span> <span class="this">this</span>;
  }
};

</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.history.js"><a href="#">davis.history</a></h2></td><td>src/davis.history.js</td></tr><tr class="code">
<td class="docs">
<p>A module to normalize and enhance the window.pushState method and window.onpopstate event.
Adds the ability to bind to whenever a new state is pushed onto the history stack and normalizes
both of these events into an onChange event.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="variable">history</span> = (<span class="keyword">function</span> () {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Bind to the history on change event.  This is not a native event but is fired any time a new
state is pushed onto the history stack or a state is popped off the history stack.</p>

<h2></h2>

<ul><li><strong>param</strong>: <em>Function</em>  handler</li></ul>

<p>The handler function will be called with a request param which is an instance of Davis.Request.
 - <strong>see</strong>: <em>Davis</em>
.Request
   </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">onChange</span> = <span class="keyword">function</span> (<span class="variable">handler</span>) {
    <span class="variable">onPushState</span>(<span class="variable">handler</span>);
    <span class="variable">onPopState</span>(<span class="variable">wrapped</span>(<span class="variable">handler</span>));
  };</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Push a request onto the history stack.  This is used internally by Davis to push a new request
onto the history stack, it will also trigger the onpushstate event.</p>

<h2></h2>

<ul><li><strong>param</strong>: <em>Davis.Request</em>  request</li></ul>

<p>An instance of Davis.Request is expected to be passed, however any object that has a title
and a path property can be passed.
   </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">pushState</span> = <span class="keyword">function</span> (<span class="variable">request</span>) {
    <span class="variable">history</span>.<span class="variable">pushState</span>(<span class="variable">request</span>, <span class="variable">request</span>.<span class="variable">title</span>, <span class="variable">request</span>.<span class="variable">path</span>);
    <span class="variable">pushStateHandlers</span>.<span class="variable">forEach</span>(<span class="keyword">function</span> (<span class="variable">handler</span>) {
      <span class="variable">handler</span>(<span class="variable">request</span>);
    });
  };</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Replace the current state on the history stack.  This is used internally by Davis when performing
a redirect.  This will trigger an onpushstate event.</p>

<h2></h2>

<ul><li><strong>param</strong>: <em>Davis.Request</em>  request</li></ul>

<p>An instance of Davis.Request is expected to be passed, however any object that has a title
and a path property can be passed.
   </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">replaceState</span> = <span class="keyword">function</span> (<span class="variable">request</span>) {
    <span class="variable">history</span>.<span class="variable">replaceState</span>(<span class="variable">request</span>, <span class="variable">request</span>.<span class="variable">title</span>, <span class="variable">request</span>.<span class="variable">path</span>);
    <span class="variable">pushStateHandlers</span>.<span class="variable">forEach</span>(<span class="keyword">function</span> (<span class="variable">handler</span>) {
      <span class="variable">handler</span>(<span class="variable">request</span>);
    });
  };</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.listener.js"><a href="#">davis.listener</a></h2></td><td>src/davis.listener.js</td></tr><tr class="code">
<td class="docs">
<p>A module to bind to link clicks and form submits and turn what would normally be http requests
into instances of Davis.Request and push these onto the history stack using the Davis.history
module.</p>

<p>This module is mixed into Davis.App prototype and accesses the Davis.App instances settings for
the selectors to use when binding to links and forms.</p>

<p>This module requires jQuery for its event binding and event object normalization.  To use Davis
with any, or no, JavaScript framework this module should be replaced with one using your framework
of choice.
 </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="variable">listener</span> = (<span class="keyword">function</span> () {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Binds to both link clicks and form submits using jquerys deleagate.  Will catch all current
and future links and forms.  Uses the apps settings for the selector to use for links and forms</p>

<ul><li><strong>see</strong>: <em>Davis</em>
.App.settings</li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">listen</span> = <span class="keyword">function</span> () {
    $(<span class="variable">document</span>).<span class="variable">delegate</span>(<span class="this">this</span>.<span class="variable">settings</span>.<span class="variable">formSelector</span>, <span class="string">'submit'</span>, <span class="variable">submitHandler</span>)
    $(<span class="variable">document</span>).<span class="variable">delegate</span>(<span class="this">this</span>.<span class="variable">settings</span>.<span class="variable">linkSelector</span>, <span class="string">'click'</span>, <span class="variable">clickHandler</span>)
  }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Unbinds all click and submit handlers that were attatched with listen.  Will efectivley stop
the current app from processing any requests and all links and forms will have their default
behaviour restored.</p>

<ul><li><strong>see</strong>: <em>Davis</em>
.App.settings</li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">unlisten</span> = <span class="keyword">function</span> () {
    $(<span class="variable">document</span>).<span class="variable">undelegate</span>(<span class="this">this</span>.<span class="variable">settings</span>.<span class="variable">linkSelector</span>, <span class="string">'click'</span>, <span class="variable">clickHandler</span>)
    $(<span class="variable">document</span>).<span class="variable">undelegate</span>(<span class="this">this</span>.<span class="variable">settings</span>.<span class="variable">formSelector</span>, <span class="string">'submit'</span>, <span class="variable">submitHandler</span>)
  }</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.logger.js"><a href="#">davis.logger</a></h2></td><td>src/davis.logger.js</td></tr><tr class="code">
<td class="docs">
<p>A module for enhancing the standard logging available through the console object.
Used internally in Davis and available for use outside of Davis.</p>

<p>Generates log messages of varying severity in the format:</p>

<p><code>[Sun Jan 23 2011 16:15:21 GMT+0000 (GMT)] &lt;message&gt;</code>
 </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="variable">logger</span> = (<span class="keyword">function</span> () {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Prints an error message to the console if the console is available.</p>

<h2></h2>

<ul><li><p><strong>params</strong>: <em>String</em>  All arguments are combined and logged to the console.</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">error</span> = <span class="keyword">function</span> () {
    <span class="keyword">if</span> (<span class="variable">window</span>.<span class="variable">console</span>) <span class="variable">console</span>.<span class="variable">error</span>.<span class="variable">apply</span>(<span class="variable">console</span>, <span class="variable">prepArgs</span>(<span class="variable">arguments</span>))
  }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Prints an info message to the console if the console is available.</p>

<h2></h2>

<ul><li><p><strong>params</strong>: <em>String</em>  All arguments are combined and logged to the console.</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">info</span> = <span class="keyword">function</span> () {
    <span class="keyword">if</span> (<span class="variable">window</span>.<span class="variable">console</span>) <span class="variable">console</span>.<span class="variable">info</span>.<span class="variable">apply</span>(<span class="variable">console</span>, <span class="variable">prepArgs</span>(<span class="variable">arguments</span>))
  }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Prints a warning message to the console if the console is available.</p>

<h2></h2>

<ul><li><p><strong>params</strong>: <em>String</em>  All arguments are combined and logged to the console.</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">warn</span> = <span class="keyword">function</span> () {
    <span class="keyword">if</span> (<span class="variable">window</span>.<span class="variable">console</span>) <span class="variable">console</span>.<span class="variable">warn</span>.<span class="variable">apply</span>(<span class="variable">console</span>, <span class="variable">prepArgs</span>(<span class="variable">arguments</span>))
  }</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.request.js"><a href="#">davis.request</a></h2></td><td>src/davis.request.js</td></tr><tr class="code">
<td class="docs">
<p>Daivs.Requests are created from click and submit events.  Davis.Requests are passed to Davis.Routes
and are stored in the history stack.  They are instantiated by Davis.listener.</p>

<ul><li><strong>constructo</strong>: <em>r</em></li></ul>

<h2></h2>

<ul><li><strong>param</strong>: <em>Object</em>  raw An object that at least contains a title, fullPath and method proprty.</li></ul>

<h2>Example</h2>

<pre><code>var request = new Davis.Request({
  title: "foo",
  fullPath: "/foo/12",
  method: "get"
})</code></pre>

<p> </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="class">Request</span> = <span class="keyword">function</span> (<span class="variable">raw</span>) {
  <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
  <span class="this">this</span>.<span class="variable">params</span> = {};
  <span class="this">this</span>.<span class="variable">title</span> = <span class="variable">raw</span>.<span class="variable">title</span>;
  <span class="this">this</span>.<span class="variable">queryString</span> = <span class="variable">raw</span>.<span class="variable">fullPath</span>.<span class="variable">split</span>(&<span class="variable">quot</span>;?&<span class="variable">quot</span>;)[<span class="number integer">1</span>];

  <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">queryString</span>) {
    <span class="this">this</span>.<span class="variable">queryString</span>.<span class="variable">split</span>(&<span class="variable">quot</span>;&<span class="variable">amp</span>;&<span class="variable">quot</span>;).<span class="variable">forEach</span>(<span class="keyword">function</span> (<span class="variable">keyval</span>) {
      <span class="keyword">var</span> <span class="variable">paramName</span> = <span class="variable">keyval</span>.<span class="variable">split</span>(&<span class="variable">quot</span>;=&<span class="variable">quot</span>;)[<span class="number integer">0</span>],
          <span class="variable">paramValue</span> = <span class="variable">keyval</span>.<span class="variable">split</span>(&<span class="variable">quot</span>;=&<span class="variable">quot</span>;)[<span class="number integer">1</span>],
          <span class="variable">nestedParamRegex</span> = <span class="regexp">/^(\w+)%5B(\w+)%5D/</span>,
          <span class="variable">nested</span>;

      <span class="keyword">if</span> (<span class="variable">nested</span> = <span class="variable">nestedParamRegex</span>.<span class="variable">exec</span>(<span class="variable">paramName</span>)) {
        <span class="keyword">var</span> <span class="variable">paramParent</span> = <span class="variable">nested</span>[<span class="number integer">1</span>];
        <span class="keyword">var</span> <span class="variable">paramName</span> = <span class="variable">nested</span>[<span class="number integer">2</span>];
        <span class="keyword">var</span> <span class="variable">parentParams</span> = <span class="variable">self</span>.<span class="variable">params</span>[<span class="variable">paramParent</span>] || {};
        <span class="variable">parentParams</span>[<span class="variable">paramName</span>] = <span class="variable">paramValue</span>;
        <span class="variable">self</span>.<span class="variable">params</span>[<span class="variable">paramParent</span>] = <span class="variable">parentParams</span>;
      } <span class="keyword">else</span> {
        <span class="variable">self</span>.<span class="variable">params</span>[<span class="variable">paramName</span>] = <span class="variable">paramValue</span>;
      };

    });
  };

  <span class="this">this</span>.<span class="variable">method</span> = <span class="this">this</span>.<span class="variable">params</span>.<span class="variable">_method</span> || <span class="variable">raw</span>.<span class="variable">method</span>;
  <span class="this">this</span>.<span class="variable">path</span> = <span class="variable">raw</span>.<span class="variable">fullPath</span>.<span class="variable">replace</span>(<span class="regexp">/\?.+$/</span>, &<span class="variable">quot</span>;&<span class="variable">quot</span>;);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>request.redirect('/foo')</h2>

<p>Redirects the current request to a new location.  Calling redirect on an instance of
Davis.Request will create a new request using the path param and the current requests title.
Redirected requests always have a method of 'get'</p>

<p>The request created will replace the current request in the history stack.  Redirect is most
often useful inside a handler for a form submit, after succesfully handling the form the app
can redirect to another path, this will mean that the current form will not be re-submitted if
navigating with the back or forward buttons as the forms submit request will have been replaced
in the browsers history stack.</p>

<h2></h2>

<ul><li><strong>param</strong>: <em>String</em>  path The path to redirect the current request to</li></ul>

<h2>Example</h2>

<pre><code>this.post('/foo', function (req) {
  processFormRequest(req.params)  // do something with the form request
  req.redirect('/bar');
})</code></pre>

<p> </p>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">prototype</span>.<span class="variable">redirect</span> = <span class="keyword">function</span> (<span class="variable">path</span>) {
  <span class="class">Davis</span>.<span class="variable">history</span>.<span class="variable">replaceState</span>(<span class="keyword">new</span> <span class="class">Davis</span>.<span class="class">Request</span> ({
    <span class="variable">method</span>: <span class="string">'get'</span>,
    <span class="variable">fullPath</span>: <span class="variable">path</span>,
    <span class="variable">title</span>: <span class="this">this</span>.<span class="variable">title</span>
  }));
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>request.toString()</h2>

<p>Converts the request to a string representation of itself by combining the method and path
attributes.</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>String</em>  string representation of the request</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">prototype</span>.<span class="variable">toString</span> = <span class="keyword">function</span> () {
  <span class="keyword">return</span> [<span class="this">this</span>.<span class="variable">method</span>.<span class="variable">toUpperCase</span>(), <span class="this">this</span>.<span class="variable">path</span>].<span class="variable">join</span>(&<span class="variable">quot</span>; &<span class="variable">quot</span>;)
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>Davis.Request.forPageLoad();</h2>

<p>Creates a new request for the page on page load.
This is required because usually requests are generated from clicking links or submitting forms
however this doesn't happen on a page load but should still be considered a request that the 
JavaScript app should handle.</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>Davis.Request</em>  A request representing the current page loading.</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Davis</span>.<span class="class">Request</span>.<span class="variable">forPageLoad</span> = <span class="keyword">function</span> () {
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="this">this</span> ({
    <span class="variable">method</span>: <span class="string">'get'</span>,
    <span class="variable">fullPath</span>: <span class="variable">window</span>.<span class="variable">location</span>.<span class="variable">pathname</span>,
    <span class="variable">title</span>: <span class="variable">document</span>.<span class="variable">title</span>
  });
}</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="src/davis.route.js"><a href="#">davis.route</a></h2></td><td>src/davis.route.js</td></tr><tr class="code">
<td class="docs">
<p>Davis.Route = (function () {</p>

<p>  var pathNameRegex = /:([\w\d]+)/g;
  var pathNameReplacement = "([^\/]+)";</p>

<p>  var klass = function (method, path, callback) {
    var convertPathToRegExp = function () {
      if (!(path instanceof RegExp)) {
        return new RegExp("^" + path.replace(pathNameRegex, pathNameReplacement) + "$", "g");
      } else {
        return path;
      };
    };</p>

<pre><code>var convertMethodToRegExp = function () {
  if (!(method instanceof RegExp)) {
    return new RegExp("^" + method + "$");
  } else {
    return method
  };
}

var capturePathParamNames = function () {
  var names = [], a;
  while ((a = pathNameRegex.exec(path))) names.push(a[1]);
  return names;
};

this.paramNames = capturePathParamNames();
this.path = convertPathToRegExp();
this.method = convertMethodToRegExp();
this.callback = callback;</code></pre>

<p>  }</p>

<p>  klass.prototype = {</p>

<pre><code>match: function (method, path) {
  return (this.method.test(method)) &amp;&amp; (this.path.test(path))
},

run: function (request) {
  this.path.lastIndex = 0
  var matches = this.path.exec(request.path);
  if (matches) {
    matches.shift();
    for (var i=0; i &lt; matches.length; i++) {
      request.params[this.paramNames[i]] = matches[i];
    };
  };
  this.path.lastIndex = 0
  return this.callback.call(request, request);
},

toString: function () {
  return [this.method, this.path].join(' ');
}</code></pre>

<p>  };</p>

<p>  return klass;
})()</p>
</td>
<td class="code">

</td>
</tr><tr class="filename"><td><h2 id="src/davis.router.js"><a href="#">davis.router</a></h2></td><td>src/davis.router.js</td></tr><tr class="code">
<td class="docs">
<p>Davis.router = function () {
  var self = this
  var verbs = ['get', 'post', 'put', 'delete'];
  var filters = ['before', 'after'];</p>

<p>  verbs.forEach(function (verb) {
    self[verb] = function (path, handler) {
      self._routeCollection.push(new Davis.Route (verb, path, handler));
    }
  })</p>

<p>  filters.forEach(function (filter) {
    self[filter] = function () {
      var method = /.+/;</p>

<pre><code>  if (arguments.length == 1) {
    var path = /.+/;
    var handler = arguments[0];
  } else if (arguments.length == 2) {
    var path = arguments[0];
    var handler = arguments[1];
  };

  self._filterCollection[filter].push(new Davis.Route (method, path, handler));
}

var lookupName = 'lookup' + filter.replace(/^\w/, function ($0) { return $0.toUpperCase()}) + 'Filter';

self[lookupName] = function (method, path) {
  return self._filterCollection[filter].filter(function (route) {
    return route.match(method, path)
  });
}</code></pre>

<p>  })</p>

<p>  self.<em>routeCollection = [];
  self.</em>filterCollection = {
    before: [],
    after: []
  };</p>

<p>  self.lookupRoute = function (method, path) {
    return this._routeCollection.filter(function (route) {
      return route.match(method, path)
    })[0];
  };
}</p>
</td>
<td class="code">

</td>
</tr>	</body>
</html></tbody></table>